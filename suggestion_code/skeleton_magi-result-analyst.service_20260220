# skeleton: magi-result-analyst.service
# /home/limonene/ROCm-project/MAGI-agents/deploy/magi-result-analyst.service
#
# 注意: これはスケルトンコードです。
# Codexは以下のコマンドで配置してください:
#   sudo cp deploy/magi-result-analyst.service /etc/systemd/system/
#   sudo systemctl daemon-reload
#
# 【Codexへの参照指示】
# systemdの挙動に関して不明点がある場合はmanページを参照。
# Ubuntu 24.04 LTS固有の挙動はtank/docs-ref/内のAMD_reference/も確認すること。
#
# 変更履歴:
#   20260220 v1: 初版
#   20260220 v2: Gemini査読対応 - EnvironmentFile を削除
#     理由: .envのクォート付き値をsystemdが誤読みする仕様がある
#     → APIキーはPython側のload_dotenv()に一任（WorkingDirectoryが正しければOK）

[Unit]
Description=MAGI result analyst (OpenRouter) - batch analyze runs
Wants=network-online.target
After=network-online.target

[Service]
Type=oneshot
WorkingDirectory=/home/limonene/ROCm-project/MAGI-agents
# EnvironmentFile は削除（load_dotenv()に一任）
ExecStart=/home/limonene/ROCm-project/MAGI-agents/.venv/bin/python /home/limonene/ROCm-project/MAGI-agents/result_analyst.py

# 安全装置
TimeoutStartSec=1800   # 30分でタイムアウト（LLM応答が詰まっても止まる）
Nice=10                # EPYCの優先度を下げる（Control Plane負荷対策）

[Install]
WantedBy=multi-user.target
